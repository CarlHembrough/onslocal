<!DOCTYPE html> 
<html> 
  <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no"> 
    <title></title>
     <!-- Latest compiled and minified CSS to go in head -->
     <link href="resources/css/nessmain.css" rel="stylesheet" type="text/css">
     <!-- Latest minified and concatenated JS to go in head -->
     <script src="resources/javascript/header.min.js"></script>
     <!-- Latest minified and concatenated JS to go in the footer -->
     <script src="resources/javascript/footer.min.js"></script>
     <script src="resources/javascript/map.js"></script>  
     <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>  
     
     <link rel="stylesheet" href="http://js.arcgis.com/3.13/esri/css/esri.css"> 
     <link rel="stylesheet" href="http://js.arcgis.com/3.13/dijit/themes/claro/claro.css">      
     <style>  
       html, body { height: 100%; width: 100%; margin: 0; padding: 0; } 
       #map{padding:0;} 
	   #innerDIV{position:absolute;z-index: 1; top:375px; left:25px; width:300px;} 
	   #outerDIV{position:relative;} 
	   #HomeButton {position: absolute;top: 250px;left: 14px;z-index: 50;}	   
     </style>
     <script src="http://js.arcgis.com/3.13/"></script>     
   
     <script> 
     
	    // Read a user input postcode and strip of plus signs,
	    // convert to uppercase and reformat if necessary
	    function  postcode_reformat(postcode) {
	       // strip + sign from postcode string & convert to uppercase
    	   postcode                     = postcode.replace(/\+/g, '');
    	   var upperCasePostCode        = postcode.toUpperCase();    	
    	   var regPostcode              = /^([a-zA-Z]){1}([0-9][0-9]|[0-9]|[a-zA-Z][0-9][a-zA-Z]|[a-zA-Z][0-9][0-9]|[a-zA-Z][0-9]){1}([ ])([0-9][a-zA-z][a-zA-z]){1}$/;
		 
	       if(regPostcode.test(upperCasePostCode) == false)	
	       {	
	    	   var re                   = /^([A-Z]{1,2}[\dA-Z]{1,2})[ ]?(\d[A-Z]{2})$/i; // case insensitive 	
	    	   var tempPostCode         = upperCasePostCode.match(re);
	    	   var reformatPostcode     = tempPostCode[1] + " " + tempPostCode[2];
	    	   return reformatPostcode;
	       }
	       else {
	    	 // postcode formatted correctly
	    	 return upperCasePostCode;
		   }	    	
		}
	    
	    // Read a page's GET URL variables and return them as an associative array.
	    function getUrlVars() {	    
	        var vars = [], hash;
	        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
	        //hashes = decodeURI(window.location.href).replace(/[?&]+([^=&]+)=([^&]*)/gi;
	        for(var i = 0; i < hashes.length; i++)
	        {
	            hash = hashes[i].split('=');
	            vars.push(hash[0]);
	            vars[hash[0]] = hash[1];
	        }
	        return vars;
	    }    
	  
	    function getUrlParams() {
	        var vars = {};
	        parts = decodeURI(window.location.href).replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
	        vars[key] = value;
	        });
	        return vars;
	    }
	    
	    var levelname;
	    var postcode;
	    
	    //postcode = getUrlVars()["nav-search"];
	    postcode =  getUrlParams()["nav-search"];
	    
	    //levelname = getUrlVars()["levelname"];
	    levelname = getUrlParams()["levelname"];
	  
		var pCode;
		if (postcode == null || postcode.length == 0 || typeof postcode === 'undefined') {
		  jsonFile      ='uk.json';	
	    } 
		else {
	      // identify json file	
		  pCode         = postcode.replace(/\+/g, '');
		  pCode         = pCode.replace(/\s/g, '');
		  jsonFile      = pCode.toLowerCase() + '.json';
		  
		  postcode = postcode_reformat(postcode);
	    }	  
		  
		$(document).ready(function(){
		  $.getJSON(jsonFile, function(result){
	         createMap(result, postcode,levelname);
		  }); 
		}); 
		
	  </script> 
  </head> 
  <body> 
      <div class="wrapper panel--mar nav-panels">
        <div class="grid-wrap">
            <header>
              <div class="global-header__wrapper">        
                   <a href="#"><img src="resources/images/ons-logo.png" alt="Insert Logo Here" width="264" height="50" id="Insert_logo" style="background-color: #FFFFFF; display: block;" /></a>       
              </div>
            </header>
        
            <div id="outerDIV" class="slate--grey search-wrapper">
              <div><a href="index.html"><img src="resources/images/home_w.png" alt="" width="50" height="50" style="position:absolute; margin-left:20px; margin-top:10px;"></a>
              </div>  
              <form class="nav-search nav-search--hidden" id="searchBar">         
                <div class="nav-search__container">
                  <label for="nav-search"></label>
                  <input type="search" class="nav-search__field" id="nav-search" name="nav-search" value="" placeholder="Search postcode or place name in England and Wales">
                </div>
                <button type="submit" class="btn btn--primary btn--nav-search" id="nav-search-submit">
                  <span class="icon-search-1" role="presentation"></span>
                </button>
                <script>  
                  $('#nav-search').attr('placeholder',postcode);                   
                </script> 
               </form>
            </div>             	             
            <div id="map"  style="height: 500px; margin-top:0px;">
               <div id="HomeButton"></div>
            </div>             
            <div id="selArea1"></div>	            
          </div>            
         </div>        
  </body>  
</html>  